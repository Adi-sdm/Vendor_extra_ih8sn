From c9f8832fff4099dfab954f7a38cec6d91446852f Mon Sep 17 00:00:00 2001
From: Francescodario Cuzzocrea <bosconovic@gmail.com>
Date: Thu, 24 Dec 2020 12:56:42 +0100
Subject: [PATCH] sepolicy: add hal_lineage_fastcharge

Change-Id: I4da91e6f3bee471a11280cdb07276211e0f6fed8
Signed-off-by: SamarV-121 <samarvispute121@gmail.com>
---
 common/dynamic/hal_lineage_fastcharge.te        | 8 ++++++++
 common/dynamic/hwservice.te                     | 1 +
 common/dynamic/hwservice_contexts               | 1 +
 common/private/platform_app.te                  | 3 +++
 common/private/system_server.te                 | 1 +
 common/public/attributes                        | 1 +
 common/vendor/hal_lineage_fastcharge_default.te | 5 +++++
 7 files changed, 20 insertions(+)
 create mode 100644 common/dynamic/hal_lineage_fastcharge.te
 create mode 100644 common/vendor/hal_lineage_fastcharge_default.te

diff --git a/common/dynamic/hal_lineage_fastcharge.te b/common/dynamic/hal_lineage_fastcharge.te
new file mode 100644
index 0000000..494b970
--- /dev/null
+++ b/common/dynamic/hal_lineage_fastcharge.te
@@ -0,0 +1,8 @@
+# HWBinder IPC from client to server
+binder_call(hal_lineage_fastcharge_client, hal_lineage_fastcharge_server)
+
+add_hwservice(hal_lineage_fastcharge_server, hal_lineage_fastcharge_hwservice)
+allow hal_lineage_fastcharge_client hal_lineage_fastcharge_hwservice:hwservice_manager find;
+
+# Allow binder communication with platform_app
+binder_call(hal_lineage_fastcharge, platform_app)
diff --git a/common/dynamic/hwservice.te b/common/dynamic/hwservice.te
index 8fb249d..c07220f 100644
--- a/common/dynamic/hwservice.te
+++ b/common/dynamic/hwservice.te
@@ -1,4 +1,5 @@
 type hal_lineage_camera_motor_hwservice, hwservice_manager_type;
+type hal_lineage_fastcharge_hwservice, hwservice_manager_type;
 type hal_lineage_fod_hwservice, hwservice_manager_type;
 type hal_lineage_livedisplay_hwservice, hwservice_manager_type;
 type hal_lineage_powershare_hwservice, hwservice_manager_type;
diff --git a/common/dynamic/hwservice_contexts b/common/dynamic/hwservice_contexts
index c01ee63..facdc5c 100644
--- a/common/dynamic/hwservice_contexts
+++ b/common/dynamic/hwservice_contexts
@@ -1,5 +1,6 @@
 vendor.lineage.biometrics.fingerprint.inscreen::IFingerprintInscreen    u:object_r:hal_lineage_fod_hwservice:s0
 vendor.lineage.camera.motor::ICameraMotor                               u:object_r:hal_lineage_camera_motor_hwservice:s0
+vendor.lineage.fastcharge::IFastCharge                                  u:object_r:hal_lineage_fastcharge_hwservice:s0
 vendor.lineage.livedisplay::IAdaptiveBacklight                          u:object_r:hal_lineage_livedisplay_hwservice:s0
 vendor.lineage.livedisplay::IAutoContrast                               u:object_r:hal_lineage_livedisplay_hwservice:s0
 vendor.lineage.livedisplay::IColorBalance                               u:object_r:hal_lineage_livedisplay_hwservice:s0
diff --git a/common/private/platform_app.te b/common/private/platform_app.te
index fa3cb86..c6ecd1e 100644
--- a/common/private/platform_app.te
+++ b/common/private/platform_app.te
@@ -1,6 +1,9 @@
 # Allow NFC service to be found
 allow platform_app nfc_service:service_manager find;
 
+# Allow FastCharge HAL service to be found
+hal_client_domain(platform_app, hal_lineage_fastcharge)
+
 # Allow FOD HAL service to be found
 hal_client_domain(platform_app, hal_lineage_fod)
 
diff --git a/common/private/system_server.te b/common/private/system_server.te
index 5d408ad..4fe1d72 100644
--- a/common/private/system_server.te
+++ b/common/private/system_server.te
@@ -3,6 +3,7 @@ allow system_server storage_stub_file:dir getattr;
 allow system_server adbroot_service:service_manager find;
 
 # Use HALs
+hal_client_domain(system_server, hal_lineage_fastcharge)
 hal_client_domain(system_server, hal_lineage_fod)
 hal_client_domain(system_server, hal_lineage_livedisplay)
 hal_client_domain(system_server, hal_lineage_touch)
diff --git a/common/public/attributes b/common/public/attributes
index 6fb39b0..2eae931 100644
--- a/common/public/attributes
+++ b/common/public/attributes
@@ -1,5 +1,6 @@
 # HALs
 hal_attribute_lineage(lineage_camera_motor)
+hal_attribute_lineage(lineage_fastcharge)
 hal_attribute_lineage(lineage_fod)
 hal_attribute_lineage(lineage_livedisplay)
 hal_attribute_lineage(lineage_touch)
diff --git a/common/vendor/hal_lineage_fastcharge_default.te b/common/vendor/hal_lineage_fastcharge_default.te
new file mode 100644
index 0000000..1e55eaf
--- /dev/null
+++ b/common/vendor/hal_lineage_fastcharge_default.te
@@ -0,0 +1,5 @@
+type hal_lineage_fastcharge_default, domain;
+hal_server_domain(hal_lineage_fastcharge_default, hal_lineage_fastcharge)
+
+type hal_lineage_fastcharge_default_exec, exec_type, vendor_file_type, file_type;
+init_daemon_domain(hal_lineage_fastcharge_default)
-- 
2.29.2

